<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Курсы онлайн</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

    <header>
        <div>
            <nav>
                <ul>
                    <li><a href="{{ url_for('main') }}"><img src="{{ url_for('static', filename='icon/chest.svg') }}" alt="Главная"></a></li>
                    <li><a href="#" class="btn">Каталог курсов</a></li>
                    <li class="nav-search">
                        <form action="{{ url_for('Search') }}" method="GET">
                            <input type="text" name="query" placeholder="Поиск...">
                            <button type="submit"><img src="{{ url_for('static', filename='icon/search-icon.png') }}" alt="Искать"></button>
                        </form>
                    </li>
                    {% if user %}
                        <li class="nav-profile"><a href="{{ url_for('UserProfile') }}"><img src="{{ url_for('static', filename='icon/user.png') }}" alt="Профиль"></a></li>
                        <li><a href="{{ url_for('logout') }}" class="btn">Выйти</a></li>
                    {% else %}
                        <li><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalSignin">Авторизация</button></li>
                        <li><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalRegister">Регистрация</button></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>

    <!-- модальное окно авторизации -->
    <div class="modal fade" id="modalSignin" tabindex="-1" aria-labelledby="modalSigninLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-4 shadow">
                <div class="modal-header p-5 pb-4 border-bottom-0">
                    <h1 class="fw-bold mb-0 fs-2" id="modalSigninLabel">Авторизация</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body p-5 pt-0">
                    <form id="signinForm">
                        <div class="form-floating mb-3">
                            <input type="email" name="Login" class="form-control rounded-3" id="floatingInput" placeholder="name@example.com">
                            <label for="floatingInput">Логин</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="password" name="Passw" class="form-control rounded-3" id="floatingPassw" placeholder="Password">
                            <label for="floatingPassword">Пароль</label>
                        </div>
                        <button class="w-100 mb-2 btn btn-lg rounded-3 btn-primary" type="submit">Войти</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- модальное окно регистрации -->
    <div class="modal fade" id="modalRegister" tabindex="-1" aria-labelledby="modalRegisterLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-4 shadow">
                <div class="modal-header p-5 pb-4 border-bottom-0">
                    <h1 class="fw-bold mb-0 fs-2" id="modalRegisterLabel">Регистрация</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body p-5 pt-0">
                    <form id="RegistrForm">
                        <div class="form-floating mb-3">
                            {{ Register.Email() }}
                            <label for="floatingInput">{{Register.Email.label}}</label>
                        </div>
                        <div class="form-floating mb-3">
                            {{ Register.Password() }}
                            <label for="floatingInput">{{Register.Password.label}}</label>
                        </div>
                        <div class="form-floating mb-3">
                            {{ Register.CheckPassword() }}
                            <label for="floatingInput">{{Register.CheckPassword.label}}</label>
                        </div>
                        <div class="w-100 mb-2 btn btn-lg rounded-3 btn-primary">
                            {{ Register.Submit() }} 
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Обработчик авторизации пользователя
        document.getElementById('signinForm').addEventListener('submit', function(event) {
            event.preventDefault();

            var email = document.getElementById('floatingInput').value;
            var password = document.getElementById('floatingPass').value;

            fetch('/signin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email: email, password: password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Обновление страницы после успешной авторизации
                    window.location.reload();
                } else {
                    alert('Неверный логин или пароль');
                }
            });
        });

        // Обработчик регистрации пользователя
        document.getElementById('RegistrForm').addEventListener('submit', function(event) {
            event.preventDefault();

            var Email = document.getElementById('floatingEmail').value;
            var Password = document.getElementById('floatingPassword').value;
            var CheckPassword = document.getElementById('floatingCheckPassword').value;

            if (CheckPassword != password) {
                alert('Пароли не совпадают!');
            }
            else {
                fetch('/signin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ Email: Email, Password: Password })
            });
            }
        });
    </script>

    <section class="hero">
        <div class="container">
            <h1>Платформа онлайн-курсов</h1>
            <p>Выбирайте и обучайтесь с нами!</p>
            <a href="#" class="btn">Начать обучение</a>
        </div>
    </section>

    <section class="courses">
        <div class="container">
            <h2>Наши курсы</h2>
            <div class="course">
                <h3>Курс по HTML</h3>
                <p>Научитесь создавать веб-страницы с нуля.</p>
                <a href="#" class="btn">Узнать больше</a>
            </div>
            <div class="course">
                <h3>Курс по CSS</h3>
                <p>Изучите каскадные таблицы стилей для стилизации ваших страниц.</p>
                <a href="#" class="btn">Узнать больше</a>
            </div>
        </div>
    </section>

    <footer>
        <nav>
            <ul>
                <li><a href="#">О нас</a></li>
                <li><a href="#">Контакты</a></li>
            </ul>
        </nav>
        <div class="container">
            <p>&copy; 2023 Курсы онлайн</p>
        </div>
    </footer>
</body>
</html>
